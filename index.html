<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">لوحة تحكم المدير</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary-color: #d63384; 
            --primary-dark: #a82263;
            --text-color: #333;
            --error-color: #dc3545;
        }

        body { margin: 0; font-family: 'Tahoma', sans-serif; background: #f8f9fa; color: #333; overflow-x: hidden; }

        .admin-nav {
            display: flex; justify-content: space-between; align-items: center;
            background: #fff; padding: 10px 20px; border-bottom: 2px solid var(--primary-color);
            position: sticky; top: 0; z-index: 1000; min-height: 55px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .nav-header { display: flex; align-items: center; gap: 10px; }
        .nav-header h1 { font-size: 1.1rem; margin: 0; color: var(--primary-color); }
        .logo-img { height: 35px; width: auto; }

        .menu-toggle {
            background: none; border: none; font-size: 1.5rem; color: var(--primary-color); cursor: pointer;
        }

        /* إصلاح القائمة المنبثقة والطبقة المظلمة */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; z-index: 1500;
        }
        .overlay.active { display: block; }

        .menu {
            position: fixed; top: 0; right: -280px; width: 260px; height: 100%;
            background: #fff; z-index: 2000; transition: 0.3s ease;
            display: flex; flex-direction: column; box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }
        .menu.active { right: 0; }

        .menu-header {
            padding: 20px; background: var(--primary-color); color: white;
            display: flex; justify-content: space-between; align-items: center;
        }

        .menu a, .menu button {
            text-decoration: none; color: var(--text-color); padding: 15px 20px;
            display: flex; align-items: center; gap: 10px; border: none;
            background: none; cursor: pointer; text-align: right; font-size: 0.95rem;
            border-bottom: 1px solid #f9f9f9;
        }
        .menu i { color: var(--primary-color); width: 20px; }
        .logout-btn { color: var(--error-color) !important; font-weight: bold; margin-top: auto; border-top: 1px solid #eee; }

        main { padding: 20px; }
        #loading { text-align: center; padding: 50px; color: var(--primary-color); }

        .cards-container {
            display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .card {
            background: #fff; border-radius: 12px; padding: 20px;
            border-right: 5px solid var(--primary-color); transition: 0.2s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
        }
        .card h2 { font-size: 1.2rem; color: var(--primary-color); display: flex; justify-content: space-between; }
        .card span { font-size: 0.9rem; background: #fee2e2; padding: 2px 8px; border-radius: 10px; color: var(--primary-dark); }
        .card .btn {
            display: block; text-align: center; background: var(--primary-color);
            color: #fff; padding: 10px; border-radius: 6px; text-decoration: none; margin-top: 15px;
        }

        @media (min-width: 992px) {
            .menu-toggle { display: none; }
            .overlay { display: none !important; }
            .menu {
                position: static; width: auto; height: auto; flex-direction: row;
                box-shadow: none; right: 0; background: transparent;
            }
            .menu a, .menu button { border: none; padding: 10px; }
            .menu-header { display: none; }
        }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <nav class="admin-nav">
        <div class="nav-header">
            <img src="https://i.postimg.cc/TwcdFYY5/img-1754957743454.png" alt="Logo" class="logo-img">
            <h1 id="headerTitle">فلامنكو</h1>
        </div>
        <button id="menuToggle" class="menu-toggle" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <div id="navMenu" class="menu">
            <div class="menu-header">
                <strong>القائمة</strong>
                <i class="fas fa-times" onclick="toggleMenu()"></i>
            </div>
            <a href="admin-novels.html"><i class="fas fa-book"></i> الروايات</a>
            <a href="admin-users.html"><i class="fas fa-users"></i> المستخدمين</a>
            <a href="admin-reports.html"><i class="fas fa-flag"></i> البلاغات</a>
            <a href="admin-notifications.html"><i class="fas fa-bell"></i> الإشعارات</a>
            <a href="admin-support.html"><i class="fas fa-headset"></i> الدعم</a>
            <a href="admin-wallet.html"><i class="fas fa-wallet"></i> المحفظة</a>
            <a href="admin-settings.html"><i class="fas fa-cogs"></i> الإعدادات</a>
            <button id="menuLogoutLink" class="logout-btn"><i class="fas fa-sign-out-alt"></i> خروج</button>
        </div>
    </nav>

    <main>
        <div id="loading">جارٍ تحميل البيانات...</div>
        <div id="cardsContainer" class="cards-container" style="display:none;">
            <div class="card">
                <h2>الروايات <span id="novelsCount">...</span></h2>
                <p>إدارة القصص والمحتوى المنشور.</p>
                <a href="admin-novels.html" class="btn">دخول</a>
            </div>
            <div class="card">
                <h2>المستخدمون <span id="usersCount">...</span></h2>
                <p>إدارة الحسابات والصلاحيات.</p>
                <a href="admin-users.html" class="btn">دخول</a>
            </div>
            <div class="card">
                <h2>الإشعارات</h2>
                <p>إرسال تنبيهات جماعية للمستخدمين.</p>
                <a href="admin-notifications.html" class="btn" style="background:#17a2b8">إرسال إشعار</a>
            </div>
            <div class="card">
                <h2>البلاغات <span id="reportsCount">...</span></h2>
                <p>مراجعة شكاوى المستخدمين.</p>
                <a href="admin-reports.html" class="btn" style="background:var(--error-color)">مراجعة</a>
            </div>
        </div>
    </main>

    <script>
        // دالة فتح وإغلاق القائمة
        function toggleMenu() {
            document.getElementById('navMenu').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        // إعداد Firebase (Compat Mode)
        const firebaseConfig = {
            apiKey: "AIzaSyBqu1PFyeQbDXeNwqdBqrIrXtm5Bs4x_fE",
            authDomain: "flamenco-novels-cf804.firebaseapp.com",
            projectId: "flamenco-novels-cf804",
            storageBucket: "flamenco-novels-cf804.firebasestorage.app",
            messagingSenderId: "356143382345",
            appId: "1:356143382345:web:ac7c1ad71139e1cbc02498"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // جلب الأعداد وعرضها
        async function fetchCounts() {
            try {
                const novels = await db.collection('novels').get();
                const users = await db.collection('users').get();
                const reports = await db.collection('reports').get();

                document.getElementById('novelsCount').innerText = novels.size;
                document.getElementById('usersCount').innerText = users.size;
                document.getElementById('reportsCount').innerText = reports.size;

                document.getElementById('loading').style.display = 'none';
                document.getElementById('cardsContainer').style.display = 'grid';
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('loading').innerText = "فشل تحميل البيانات.";
            }
        }

        // التحقق من حالة الدخول
        auth.onAuthStateChanged(user => {
            if (user) {
                fetchCounts();
            } else {
                window.location.href = "admin-login.html";
            }
        });

        // تسجيل الخروج
        document.getElementById('menuLogoutLink').addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = "admin-login.html";
            });
        });
    </script>
</body>
</html>
